
var PlatformApp={};if(jQuery===undefined){jQuery=$={}}!function(e,d,a,f){jQuery.extend(true,{context:function(i,h){if(typeof h=="string"){var g=i;i=i[h];h=g}return function(){return i.apply(h,arguments)}},setCookie:function(h,i,g){a.cookie=PlatformApp._cookieConfig.prefix+h+"="+encodeURIComponent(i)+(g===undefined?"":";expires="+g.toUTCString())+(PlatformApp._cookieConfig.path?";path="+PlatformApp._cookieConfig.path:"")+(PlatformApp._cookieConfig.domain?";domain="+PlatformApp._cookieConfig.domain:"");return i},getCookie:function(g){var i,h;i=new RegExp("(^| )"+PlatformApp._cookieConfig.prefix+g+"=([^;]+)(;|$)");h=i.exec(a.cookie);if(h){return decodeURIComponent(h[2])}else{return null}},deleteCookie:function(g){console.info("Delete cookie %s",g);a.cookie=PlatformApp._cookieConfig.prefix+g+"="+(PlatformApp._cookieConfig.path?"; path="+PlatformApp._cookieConfig.path:"")+(PlatformApp._cookieConfig.domain?"; domain="+PlatformApp._cookieConfig.domain:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT";return null},});jQuery.fn.extend({appActivate:function(){return PlatformApp.activate(this)},appFadeIn:function(g,h){return this.fadeIn(g,function(){e(this).ieOpacityFix(h)})},appFadeOut:function(g,h){return this.fadeOut(g,h)},appShow:function(g,h){return this.show(g,function(){e(this).ieOpacityFix(h)})},appHide:function(g,h){return this.hide(g,h)},appSlideDown:function(g,h){return this.slideDown(g,function(){e(this).ieOpacityFix(h)})},appSlideUp:function(g,h){return this.slideUp(g,h)},appFadeDown:function(g,h){this.filter(":hidden").appHide().css("opacity",0);g=g||PlatformApp.speed.normal;return this.appSlideDown(PlatformApp.speed.fast).animate({opacity:1},g,function(){e(this).ieOpacityFix(h)})},appFadeUp:function(h,j,g,i){h=((typeof h=="undefined"||h===null)?PlatformApp.speed.normal:h);g=((typeof g=="undefined"||g===null)?h:g);return this.slideUp({duration:Math.max(h,g),easing:i||"swing",complete:j,queue:false}).animate({opacity:0,queue:false},h)},appInsert:function(j,h,g,i,k){if(j=="replaceAll"){e(h).appFadeUp(i)}this.addClass("__AppActivator").css("display","none")[j||"appendTo"](h).appActivate()[g||"appFadeDown"](i,k);return this},appRemove:function(g,j,h,i){return this[g||"appFadeUp"](PlatformApp.speed.normal,function(){e(this).empty().remove();if(e.isFunction(j)){j()}},h,i)},ieOpacityFix:function(g){if(!e.support.opacity){this.css("filter","");this.attr("style",this.attr("style").replace(/filter:\s*;/i,""))}if(e.isFunction(g)){g.apply(this)}return this},});e.extend(PlatformApp,{_csrfToken:"",_cookieConfig:{path:"/",domain:"",prefix:"lnx_"},_baseUrl:false,speed:{xxfast:50,xfast:100,fast:200,normal:400,slow:600},formatter:{timeZone:"Asia/Ho_Chi_Minh",decimals:0,decPoint:",",thousandsSep:".",},phrases:{},init:function(){PlatformApp.activate(a);if(!("autofocus" in a.createElement("input"))){e("input[autofocus], textarea[autofocus], select[autofocus]").first().focus()}},baseUrl:function(){if(PlatformApp._baseUrl===false){var g=a.createElement("a"),h=e("base");g.href="";PlatformApp._baseUrl=(g.href.match(/[^\x20-\x7f]/)&&h.length)?h.attr("href"):g.href;if(!h.length){PlatformApp._baseUrl=PlatformApp._baseUrl.replace(/\?.*$/,"").replace(/\/[^\/]*$/,"/")}}return PlatformApp._baseUrl},csrfToken:function(){if(PlatformApp._csrfToken===""){var g=e('meta[name="csrf-token"]');if(g.length){PlatformApp._csrfToken=g.attr("content")}}return PlatformApp._csrfToken},activate:function(i){var g=e(i);console.group("PlatformApp.activate(%o)",i);g.trigger("AppActivate").removeClass("__AppActivator");g.find("noscript").empty().remove();e(a).trigger({element:i,type:"ActivateHtml"});var h=g.find("form.AutoSubmit:first");if(h.length){h.submit();h.find('input[type="submit"], input[type="reset"]').hide()}console.groupEnd();return i},register:function(g,i,j){if(typeof i=="string"){var h=i;i=function(k){PlatformApp.create(h,this)}}e(a).bind(j||"ActivateHtml",function(k){e(k.element).find(g).each(i)})},create:function(l,k){var g=e(k),h=d,m=l.split("."),j;for(j=0;j<m.length;j++){h=h[m[j]]}if(typeof h!="function"){return console.error("%s is not a function.",l)}if(!g.data(l)){g.data(l,new h(g))}return g.data(l)},hashCode:function(l){var k=0,h,j,g;if(l.length===0){return k}for(h=0,g=l.length;h<g;h++){j=l.charCodeAt(h);k=((k<<5)-k)+j;k|=0}return k},numberFormat:function c(k,i,o,m){k=(k+"").replace(/[^0-9+\-Ee.]/g,"");var h=!isFinite(+k)?0:+k;var g=!isFinite(+i)?this.formatter.decimals:Math.abs(i);var q=(typeof m==="undefined")?this.formatter.thousandsSep:m;var j=(typeof o==="undefined")?this.formatter.decPoint:o;var p="";var l=function(t,s){var r=Math.pow(10,s);return""+(Math.round(t*r)/r).toFixed(s)};p=(g?l(h,g):""+Math.round(h)).split(".");if(p[0].length>3){p[0]=p[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,q)}if((p[1]||"").length<g){p[1]=p[1]||"";p[1]+=new Array(g-p[1].length+1).join("0")}return p.join(j)},ajax:function(j,l,m,i){var g=function(n,o){m.call(null,n,o)};var k=d.location.href;if(k.match(/[^\x20-\x7f]/)){var h=a.createElement("a");h.href="";k=k.replace(h.href,PlatformApp.baseUrl())}i=e.extend(true,{data:l,url:j,success:g,type:"POST",dataType:"json",error:function(p,q,o){if(p.readyState==0){return}try{g.call(null,e.parseJSON(p.responseText),q)}catch(n){}},headers:{"X-Ajax-Referer":k},timeout:30000},i);return e.ajax(i)},toastAlert:function(i,h){h=h||3000;var j=e('<div class="toast"><div class="toast-container"><div class="toast-icon"><div class="action-toast-icon"><i class="fa fa-check" aria-hidden="true"></i></div></div><div class="toast-content">'+i+"</div></div></div>"),k=e("#action-toast");if(!k.length){k=e('<div id="action-toast"></div>').appendTo("body")}j.find("div.toast-content").html(i).end().appendTo(k);function g(){j.remove()}j.click(g);if(h){setTimeout(g,h)}return j},confirm:function(i,j,g){g=e.extend(true,{id:"platformAppConfirmDialog",title:"Confirm",okLabel:"Yes",cancelLabel:"No",okClass:"btn btn-danger",okBtnId:"okPlatformConfirmButton",cancelClass:"btn",},g);if(j===undefined){j=function(){return true}}if(!e("#"+g.id).length){var h='<div class="modal fade" id="'+g.id+'" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+g.title+'</h4></div><div class="modal-body">'+i+'</div><div class="modal-footer"><button type="button" data-dismiss="modal" class="'+g.okClass+' DisableOnSubmit" id="'+g.okBtnId+'">'+g.okLabel+'</button><button type="button" data-dismiss="modal" class="'+g.cancelClass+'">'+g.cancelLabel+"</button></div></div></div></div>";e("body").append(h)}e("#"+g.id).on("hidden.bs.modal",function(k){e(k.currentTarget).unbind()});return e("#"+g.id).modal().one("click","#"+g.okBtnId,function(k){k.preventDefault();j.call(null)})},copyToClipboard:function(i){var o="_hiddenCopyText_";var n=i.tagName==="INPUT"||i.tagName==="TEXTAREA";var k,h;if(n){m=i;k=i.selectionStart;h=i.selectionEnd}else{m=a.getElementById(o);if(!m){var m=a.createElement("textarea");m.style.position="absolute";m.style.left="-9999px";m.style.top="0";m.id=o;a.body.appendChild(m)}m.textContent=i.textContent}var g=a.activeElement;m.focus();m.setSelectionRange(0,m.value.length);var j;try{j=a.execCommand("copy")}catch(l){j=false}if(g&&typeof g.focus==="function"){g.focus()}if(n){i.setSelectionRange(k,h)}else{m.textContent=""}return j}});PlatformApp.FieldAdder=function(g){g.click(function(j){var k=e(g.data("source")),h=g.data("maxfields"),i=null;if(k.length&&(!h||(k.length<h))){i=k.last().clone();i.html(function(m,l){return l.replace(/\[[0-9]+\]/g,"["+k.length+"]")});i.find('input:not([type="button"], [type="submit"])').val("").prop("disabled",true);i.find(".spinBoxButton").remove();i.find('input[type="radio"]').prop("checked",false);g.trigger({type:"FieldAdderClone",clone:i});i.appInsert("insertAfter",k.last(),false,false,function(){var l=i.find("input");l.prop("disabled",false);l.first().focus().select();if(h){if(e(g.data("source")).length>=h){g.appRemove()}}})}})};PlatformApp.FieldRemover=function(g){g.click(function(j){var k=e(e(this).parents(g.data("source"))),i=g.data("minfields"),h=k.siblings().length;if(k.length&&(!i||(h>i))){k.appRemove()}})};PlatformApp.Disabler=function(k){var i=function(n,o){var p=h.find("input, select, textarea, button, .inputWrapper"),m=o?0:PlatformApp.speed.fast,l=function(q){h.find("input:not([type=hidden], [type=file]), textarea, select, button").first().focus().select()};if(k.is(":checked:enabled")){h.removeAttr("disabled").removeClass("disabled").trigger("DisablerDisabled");p.removeAttr("disabled").removeClass("disabled");if(k.hasClass("Hider")){if(o){h.show()}else{h.appFadeDown(m,o?null:l)}}else{if(!o){l.call()}}}else{if(k.hasClass("Hider")){if(o){h.hide()}else{h.appFadeUp(m,null,m,"easeInBack")}}h.prop("disabled",true).addClass("disabled").trigger("DisablerEnabled");p.prop("disabled",true).addClass("disabled").each(function(s,t){var q=e(t),r=q.data("disabled");if(r!==null&&typeof(r)!="undefined"){q.val(r)}})}},h=e("#"+k.attr("id")+"_Disabler"),g=k.closest("form");var j=function(){setTimeout(i,0)};if(k.is(":radio")){g.find('input:radio[name="'+k.fieldName()+'"]').click(j)}else{k.click(j)}g.bind("reset",j);g.bind("AppRecalculate",function(){i(null,true)});i(null,true);h.find("label, input, select, textarea").click(function(l){if(!k.is(":checked")){k.prop("checked",true);i()}});this.setStatus=i};PlatformApp.ModalTrigger=function(k,j){if(e(j).length<=0){var i=e(k).data("cached"),h=e(k).data("width");if(i===undefined){i=true}if(h===undefined){h=0}j=j.replace("#","");var g='<div class="modal fade" id="'+j+'"'+(i?' data-cached="true" ':' data-cached="false" ')+'role="dialog" aria-labelledby="gridSystemModalLabel" aria-hidden="true"><div class="modal-dialog" role="document"'+(h?' style="width:'+h+'px;"':"")+'><div class="modal-content"></div></div></div>';e("body").append(g)}};PlatformApp.submitFrom=function(g,i){var h=e(i);var j=e(g);e(".loading").css("display","block");e.ajax({url:h.attr("action"),type:"POST",data:h.serialize(),success:function(k){var n=JSON.parse(k);if(n==="success"){j.modal("toggle");d.location.reload()}else{var l=e(i).find("#message-box");l.removeClass("hidden").html("");var m=e("<ul>");e.each(n,function(o,p){m.append(e("<li>",{text:p[0]}))});l.append(m)}e("#loading").fadeOut()}})};PlatformApp.MultiSubmitFix=function(h){var g="input:submit, input:reset, input.PreviewButton, input.DisableOnSubmit, button:submit, button.DisableOnSubmit",j=function(){e(d).unbind("unload",j);h.trigger("EnableSubmitButtons").find(g).removeClass("disabled").removeAttr("disabled")};var i=function(k){setTimeout(function(){var l="WebkitAppearance" in a.documentElement.style;if(!l){e(d).bind("unload",j)}h.trigger("DisableSubmitButtons").find(g).prop("disabled",true).addClass("disabled")},0);setTimeout(j,5000)};h.find(g).on("click",function(k){k.preventDefault();h.submit()});h.data("MultiSubmitEnable",j).data("MultiSubmitDisable",i).submit(i);return j};PlatformApp.AjaxSubmit=function(h){var g=function(m){if(/^[a-z0-9_]+$/i.test(m)){return this[m]}else{if(m.indexOf(".")>=0){var l=m.split("."),k;var j=this;for(k=0;k<l.length;k++){j=j[l[k]]}return j}}return false};h.on("submit",function(k){k.preventDefault();k.stopPropagation();var j=h.data("yiiActiveForm"),i=g(h.data("callback"));if(j.validated){PlatformApp.ajax(h.attr("action"),h.serialize(),function(l,o){if(l.status===200){if(i){i.call(null,l,o)}}else{if(l.errors){e.each(j.attributes,function(q,p){var r=p.name;if(typeof l.errors[r]!="undefined"){e(p.container+" "+p.error).html(l.errors[r].join(" "));e(p.container).removeClass("has-success").addClass("has-error");delete l.errors[r]}});var n=h.find(".errorSummary");if(Object.keys(l.errors).length){if(!n.length){n=e('<div class="alert alert-block alert-danger errorSummary"></div>');h.prepend(n)}var m="";e.each(l.errors,function(p,q){m+="<p>"+q.join(" ")+"</p>"});n.html(m);console.log(n.attr("class"));n.removeClass("hidden")}else{if(n.length){n.addClass("hidden")}}}}})}})};PlatformApp.CopyToClipboard=function(g){g.click(function(i){i.preventDefault();var j=e(this).data("target-id");if(j!==undefined){var h=a.getElementById(j);if(PlatformApp.copyToClipboard(h)){PlatformApp.toastAlert("Đã copy")}else{PlatformApp.toastAlert("Chưa copy được nội dung")}}})};PlatformApp.Popover=function(g){g.popover({html:true}).click(function(h){h.preventDefault();e(".popover-content").append("<i class='fa fa-close close-popover'></i>");e(".close-popover").click(function(i){((g.popover("hide").data("bs.popover")||{}).inState||{}).click=false})})};PlatformApp.PopoverRegister=function(g){PlatformApp.register(g,"PlatformApp.Popover");e(a).on("click",function(h){e(g).each(function(){if(!e(this).is(h.target)&&e(this).has(h.target).length===0&&e(".popover").has(h.target).length===0){((e(this).popover("hide").data("bs.popover")||{}).inState||{}).click=false}})})};PlatformApp.ItemsSelect=function(g){this.__construct(g)};PlatformApp.ItemsSelect.prototype={selectedItems:null,__construct:function(j){var i,g,h;if(j.data("checkbox-selector")===undefined){console.warn("ERROR: No checkbox for select.");return}this.checkBoxSelector=j.data("checkbox-selector");if(j.data("itemcount")){this.$itemcount=e(j.data("itemcount"))}else{this.$itemcount=false}if(j.data("cookie-id")){this.cookieId=j.data("cookie-id")}else{this.cookieId="selectedItems"}if(j.data("unselect-elem")){this.$unselectElem=e(j.data("unselect-elem"))}else{this.$unselectElem=e(".unselectall-items")}if(j.data("checkbox-all")){e(a).on("click",j.data("checkbox-all"),e.context(this,"onClickCheckAll"))}e(a).on("click",this.checkBoxSelector,e.context(this,"onClickCheckbox"));if(this.$unselectElem.length){this.$unselectElem.on("click",e.context(this,"unselectAll"))}},updateItemCount:function(g){if(this.$itemcount){this.$itemcount.html(g);if(g>0){this.$itemcount.parent().show();this.$unselectElem.show()}else{this.$itemcount.parent().hide();this.$unselectElem.hide()}}},getSelectedItems:function(){if(!this.selectedItems){console.log(this.selectedItems);this.selectedItems=e.getCookie(this.cookieId)}if(this.selectedItems===null){return[]}return this.selectedItems.split(",")},unselectAll:function(g){g.preventDefault();e.setCookie(this.cookieId,"");this.selectedItems=null;this.updateItemCount(0);this.$unselectElem.hide();location.reload()},unselect:function(i){var h=this.getSelectedItems();var g=h.indexOf(i);if(g>=0){h.splice(g,1);this.updateItemCount(h.length);this.selectedItems=h.join(",");e.setCookie(this.cookieId,this.selectedItems)}},select:function(h){var g=this.getSelectedItems();if(g.indexOf(h)<0){g.push(h);this.updateItemCount(g.length);this.selectedItems=g.join(",");e.setCookie(this.cookieId,this.selectedItems)}},onClickCheckbox:function(g){if(e(g.target).is(":checked")){this.select(e(g.target).val())}else{this.unselect(e(g.target).val())}},onClickCheckAll:function(i,h){var g=e(i.target).is(":checked");e(this.checkBoxSelector).each(function(j,k){if(g){this.select(k.value)}else{this.unselect(k.value)}}.bind(this))}};PlatformApp.register("a.FieldAdder, input.FieldAdder","PlatformApp.FieldAdder");PlatformApp.register("a.FieldRemover","PlatformApp.FieldRemover");PlatformApp.register("input:checkbox.Disabler, input:radio.Disabler","PlatformApp.Disabler");PlatformApp.register("form.lnxForm, .MultiSubmitFix","PlatformApp.MultiSubmitFix");PlatformApp.register("form.ajaxSubmit","PlatformApp.AjaxSubmit");PlatformApp.register(".copyButton","PlatformApp.CopyToClipboard");PlatformApp.PopoverRegister('[data-toggle="popover"]');PlatformApp.register(".itemsSelect","PlatformApp.ItemsSelect");var b=false;e(d).on("load",function(){if(b||!d.location.hash){return}var h=d.location.hash.replace(/[^a-zA-Z0-9_-]/g,""),g=h?e("#"+h):e();if(g.length){g.get(0).scrollIntoView(true)}});e(d).bind("beforeunload",function(){e("#loading").show();setTimeout(function(){e("#loading").hide()},15000)});e(function(){PlatformApp.init();if(d.location.hash){e(d).one("scroll",function(g){b=true})}})}(jQuery,this,document);